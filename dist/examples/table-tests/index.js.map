{"version":3,"file":"index.js","sources":["../../../spui/utils.ts","../../../spui/stream.ts","../../../spui/dom.ts","../../../examples/table-tests/app.ts","../../../spui/observable-array.ts","../../../examples/table-tests/store.ts","../../../examples/table-tests/index.ts"],"sourcesContent":["export interface StringKeyMap<T> {\r\n    [key: string]: T;\r\n}\r\nexport type Functor0P = () => any;\r\nexport type Functor1P = (value: any) => any;\r\n\r\nexport function isFunction(obj): obj is Function {\r\n    return typeof obj === 'function';\r\n}\r\n\r\nexport function isNode(obj): obj is Node {\r\n    return obj.nodeType;\r\n}\r\n\r\nexport function isObject(obj): obj is Object {\r\n    return typeof obj === 'object';\r\n}\r\n\r\nexport function isString(obj): obj is string {\r\n    return typeof obj === 'string'; \r\n}\r\n\r\nexport function expandValue(value): any {\r\n    return isFunction(value) ? value() : value; \r\n}\r\n\r\nexport function remove(array: Array<any>, value) {\r\n    const i = array.indexOf(value);\r\n    if (i !== -1) {\r\n        array.splice(i, 1);\r\n    }\r\n    return array;\r\n}","import { isFunction, remove, Functor0P, Functor1P} from './utils';\r\nexport interface GetterSetter {\r\n    (value?): any;\r\n}\r\nexport interface Stream extends GetterSetter {\r\n    _backingValue: any;\r\n    _listeners?: Array<Functor1P>;\r\n    _transform?: Functor1P;\r\n}\r\nexport interface Computation {\r\n    computedStream: Stream;\r\n    dependencies: Stream[];\r\n}\r\n\r\nlet runningComputations: Array<Computation> = [];\r\n\r\nfunction setValue(stream, value) {\r\n    stream._backingValue = stream._transform ? stream._transform(value) : value;\r\n    if (stream._listeners.length) {\r\n        const dependencies = stream._listeners.slice();\r\n        for (let i = 0; i < dependencies.length; ++i) {\r\n            dependencies[i](stream._backingValue);\r\n        }\r\n    }\r\n}\r\n\r\nexport function valueStream(initialValue?, transform?: Functor1P) : Stream {\r\n    let stream = function (value?) {\r\n        if (arguments.length) {\r\n            setValue(stream, value);\r\n        } else {\r\n            // Check to create a new computation dependency:\r\n            if (runningComputations.length) {\r\n                const computation = runningComputations[runningComputations.length - 1];\r\n                addListener(stream, computation.computedStream);\r\n                computation.dependencies.push(stream);\r\n            }\r\n        }\r\n        \r\n        return stream._backingValue;\r\n    } as Stream;\r\n\r\n    stream._listeners = [];\r\n    if (transform) {\r\n        stream._transform = transform;\r\n    }\r\n    if (initialValue !== undefined) {\r\n        setValue(stream, initialValue);\r\n    }\r\n\r\n    return stream;\r\n}\r\n\r\nexport function addListener(stream: Stream, listener: Functor1P) : Functor0P {\r\n    if (stream._listeners.indexOf(listener) === -1) {\r\n        stream._listeners.push(listener);\r\n    }\r\n    return () => removeListener(stream, listener);\r\n}\r\n\r\nexport function removeListener(valueStream: Stream, listener: Functor1P) : void {\r\n    remove(valueStream._listeners, listener);\r\n}\r\n\r\nexport function addTransform(valueStream: Stream, transform: Functor1P) {\r\n    if (valueStream._transform) {\r\n        const firstTransform = valueStream._transform;\r\n        valueStream._transform = value => transform(firstTransform(value));\r\n    } else {\r\n        valueStream._transform = transform;\r\n    }\r\n}\r\n\r\nexport function map(vs: Stream, transform: Functor1P) : Stream {\r\n    const computedStream = valueStream(vs(), transform);\r\n    addListener(vs, computedStream);\r\n    return computedStream;\r\n}\r\n\r\nfunction createComputation() : Computation {\r\n    return {\r\n        computedStream: valueStream(),\r\n        dependencies: []\r\n    };\r\n}\r\n\r\nexport function compute(functor: Functor0P) : Computation {\r\n    const computation = createComputation();\r\n    computation.computedStream(_compute());\r\n    addTransform(computation.computedStream, _compute);\r\n    return computation;\r\n\r\n    function _compute() {\r\n        runningComputations.push(computation);\r\n        let result, error;\r\n        try {\r\n            result = functor();\r\n        }\r\n        catch (e) {\r\n            error = e;\r\n        }\r\n        runningComputations.pop();\r\n        if (error) throw error;\r\n        return result;\r\n    }\r\n}\r\n\r\nexport function computeStream(functor: Functor0P): Stream {\r\n    return compute(functor).computedStream;\r\n}\r\n\r\nexport function eventStream(source: EventTarget | string, name: string, useCapture?) {\r\n    const eventStream = valueStream();\r\n    const element = source instanceof EventTarget ? source : document.querySelector(source);\r\n    element.addEventListener(name, eventStream, !!useCapture);\r\n    return eventStream;\r\n}","import { isNode, isFunction, isString, isObject, expandValue, StringKeyMap, Functor0P, Functor1P} from './utils';\r\nimport * as s from './stream';\r\nimport {ObservableArray} from './observable-array';\r\n\r\nexport type Attrs = StringKeyMap<any>;\r\nexport type ElementGenerator = () => HTMLElement;\r\nexport type StringGenerator = () => string;\r\nexport type Child = string | HTMLElement | ElementGenerator | StringGenerator;\r\nexport type Children = Array<Child> | Child;\r\nexport type ModelElementCreator = (listRootElement: HTMLElement, model: any, indeX: number) => HTMLElement;\r\n\r\nexport function h(tagName: string, attrs?: Attrs, children?: Children) {\r\n    const element = document.createElement(tagName);\r\n    if (attrs) {\r\n        setAttrs(element, attrs);\r\n    }\r\n\r\n    if (children) {\r\n        setChildren(element, children);\r\n    }\r\n    return element;\r\n}\r\n\r\nfunction setAttrs(element: HTMLElement, attr: Attrs) {\r\n    // For each attr, setup a computation. When that computation is triggered, we patch this argument:\r\n    for (const attrName in attr) {\r\n        const attrValue = attr[attrName];\r\n        // Event registration handling.\r\n        if (attrName.startsWith('on')) {\r\n            const eventName = attrName.slice(2);\r\n            element.addEventListener(eventName, attrValue);\r\n            continue;\r\n        }\r\n\r\n        // If attrValue is an object (for classes and styles)\r\n        // or if attrValue is a function: setup a computation\r\n        if (isFunction(attrValue) || isObject(attrValue)) {\r\n            // For all attributes resulting from a computation setup auto update:\r\n            const computation = s.compute(() => {\r\n                setAttr(element, attrName, attrValue);\r\n            });\r\n\r\n            // Check if the attrValue function has actually registered a dependency:\r\n            if (computation.dependencies.length) {\r\n                s.addTransform(computation.computedStream, () => {\r\n                    setAttr(element, attrName, attrValue);\r\n                });\r\n            }\r\n            continue;\r\n        }\r\n        // Handle static attributes:\r\n        setAttr(element, attrName, attrValue);\r\n    }\r\n}\r\n\r\nfunction setAttr(element: HTMLElement, attr: string, value: any) {\r\n    value = expandValue(value);\r\n    switch(attr) {\r\n        case 'class':\r\n        case 'className':\r\n            setClass(element, value);\r\n        break\r\n        case 'style':\r\n            setStyle(element, value);\r\n        break;\r\n        default: \r\n            if (attr in element) {\r\n                element[attr] = value;\r\n            } else if (value === false) {\r\n                element.removeAttribute(attr);\r\n            } else if (value === true) {\r\n                // If value is a boolean, set it to \"\" to only enable it in DOM.\r\n                element.setAttribute(attr, \"\");\r\n            } else {\r\n                element.setAttribute(attr, value);\r\n            }\r\n    }\r\n}\r\n\r\nfunction setClass(element: HTMLElement, className: string | Attrs) {\r\n    if (isString(className)) {\r\n        element.className = className;\r\n    } else {\r\n        let newClass = '';\r\n        for (const key in className) {\r\n            let value = className[key];\r\n            value = expandValue(value);\r\n            if (value) {\r\n                newClass += (newClass == '' ? '' : ' ' ) + key;\r\n            }\r\n        }\r\n        element.className = newClass;\r\n    }\r\n}\r\n\r\nfunction setStyle(element: HTMLElement, style: Attrs | string, value?) {\r\n    if (isString(style)) {\r\n        element.setAttribute('style', style);\r\n    } else {\r\n        for (const key in style) {\r\n            const styleValue = expandValue(style[key]);\r\n            element.style[key] = styleValue;\r\n        }\r\n    }\r\n}\r\n\r\nfunction setChildren(element: HTMLElement, children: Children) {\r\n    if (Array.isArray(children)) {\r\n        for (let i = 0; i < children.length; ++i) {\r\n            appendChild(element, children[i]);\r\n        }\r\n    } else {\r\n        appendChild(element, children);\r\n    }\r\n}\r\n\r\nfunction appendChild(element: HTMLElement, child: Child) {\r\n    if (!child) return;\r\n    if (isFunction(child)) {\r\n        let resolvedChild: HTMLElement | string;\r\n        const computation = s.compute(() => {\r\n            resolvedChild = child();\r\n        });\r\n\r\n        let childNode = isNode(resolvedChild) ? resolvedChild : document.createTextNode(resolvedChild);\r\n        element.appendChild(childNode);\r\n\r\n        if (computation.dependencies.length) {\r\n            // Auto update in case children is a stream\r\n            s.addTransform(computation.computedStream, () => {\r\n                const oldChildNode = childNode;\r\n                childNode = isNode(resolvedChild) ? resolvedChild : document.createTextNode(resolvedChild);\r\n                element.replaceChild(childNode, oldChildNode);\r\n            });\r\n        }\r\n    } else if (isNode(child)) {\r\n        element.appendChild(child);\r\n    } else {\r\n        element.appendChild(document.createTextNode(child));\r\n    }\r\n}\r\n\r\nexport class ElementListMapper {\r\n    modelsObs: ObservableArray<any>;\r\n    listRootElement: HTMLElement;\r\n    elementCreator: ModelElementCreator;\r\n    key: string;\r\n    modelToElement: Map<any, HTMLElement>;\r\n    constructor(listRootElement: HTMLElement, modelsObs: ObservableArray<any>, elementCreator: ModelElementCreator, key?: string) {\r\n        this.listRootElement = listRootElement;\r\n        this.modelsObs = modelsObs;\r\n        this.elementCreator = elementCreator;\r\n        // TODO: What to do with key?\r\n        this.key = key;\r\n        this.modelToElement = new Map<any, HTMLElement>();\r\n        modelsObs.addListener(this.onModelChange.bind(this));\r\n\r\n        if (this.modelsObs.length) {\r\n            const nodes = this.createElements(this.modelsObs.array, 0);\r\n            this.listRootElement.appendChild(nodes);\r\n        }\r\n    }\r\n\r\n    onModelChange (op: string, args: any[]) {\r\n        switch(op) {\r\n            case 'pop':\r\n                this.listRootElement.removeChild(this.listRootElement.lastChild);\r\n                break;\r\n            case 'push': {\r\n                const nodes = this.createElements(args, this.modelsObs.length - args.length);\r\n                this.listRootElement.appendChild(nodes);\r\n                break;\r\n            }\r\n            case 'reverse': {\r\n                const frag = new DocumentFragment();\r\n                while (this.listRootElement.lastChild) {\r\n                    frag.appendChild(this.listRootElement.removeChild(this.listRootElement.lastChild));\r\n                }\r\n                this.listRootElement.appendChild(frag);\r\n                break;\r\n            };\r\n            case 'splice':\r\n                const childNodes = this.listRootElement.childNodes;\r\n                const spliceStart = args[0] < 0 ? childNodes.length + args[0] : args[0];\r\n                const deleteCount = args.length > 1 ? args[1] : childNodes.length - spliceStart;\r\n                const deleteStop = spliceStart + deleteCount;\r\n                // TODO: have a more flexible splice that doesn't ALWAYS create a toRemove array\r\n                // or keep the list of ordered nodes on the side?\r\n                const toRemove = [];\r\n                for (let i = spliceStart; i < deleteStop; i++) {\r\n                    toRemove.push(childNodes[i]);\r\n                }\r\n                for (let i = 0; i < toRemove.length; ++i) {\r\n                    this.listRootElement.removeChild(toRemove[i]);\r\n                }\r\n\r\n                if (args.length > 2) {\r\n                    const nodes = this.createElements(args.slice(2), spliceStart);\r\n                    this.listRootElement.insertBefore(nodes, childNodes[spliceStart]);\r\n                }\r\n                break;\r\n            case 'shift':\r\n                this.listRootElement.removeChild(this.listRootElement.firstChild);\r\n                break;\r\n            case 'sort': {\r\n                const frag = new DocumentFragment();\r\n                for (let i = 0; i < this.modelsObs.length; ++i) {\r\n                    const node = this.modelToElement.get(this.modelsObs.array[i]);\r\n                    this.listRootElement.removeChild(node);\r\n                    frag.appendChild(node);\r\n                }\r\n                this.listRootElement.appendChild(frag);\r\n                break;\r\n            }\r\n            case 'unshift': {\r\n                const nodes = this.createElements(args, 0);\r\n                this.listRootElement.insertBefore(nodes, this.listRootElement.firstChild);\r\n                break;\r\n            }\r\n            case 'changes': {\r\n                const changes = args;\r\n                for (let i = 0; i < changes.length; ++i) {\r\n                    this.onModelChange(changes[i][0], changes[i][1]);\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    createElements(models: Array<any>, startIndex: number) : DocumentFragment | HTMLElement {\r\n        if (models.length > 1) {\r\n            const frag = new DocumentFragment();\r\n            for (let i = 0; i < models.length; ++i) {\r\n                const childNode = this.createElement(models[i], startIndex++);\r\n                frag.appendChild(childNode);\r\n            }\r\n            return frag;\r\n        }\r\n\r\n        return this.createElement(models[0], startIndex);\r\n    }\r\n\r\n    createElement(model, index: number) : HTMLElement {\r\n        const childNode = this.elementCreator(this.listRootElement, model, index);\r\n        this.modelToElement.set(model, childNode);\r\n        return childNode;\r\n    }\r\n}\r\n\r\nexport function elementList(tagName: string, attrs: Attrs, models: ObservableArray<any>, nodeCreator: ModelElementCreator, key?: string) {\r\n    const listRootElement = h(tagName, attrs);\r\n    (parent as any)._elementList = new ElementListMapper(listRootElement, models, nodeCreator, key);\r\n    return  listRootElement;\r\n}\r\n\r\nexport function isElementList(nodeListElement: HTMLElement) : boolean {\r\n    return !!((parent as any)._elementList);\r\n}\r\n\r\nexport function getElementList(nodeListElement: HTMLElement): ElementListMapper {\r\n    return (parent as any)._elementList;\r\n}\r\n\r\nexport function targetAttr(eventAttrName: string, functor: s.Stream | Functor1P) {\r\n    return function (event) {\r\n        return functor(event.target[eventAttrName]);\r\n    }\r\n}","import {Store} from './store';\r\nimport {h, elementList, getElementList} from '../../spui/dom';\r\nimport * as s from '../../spui/stream';\r\n\r\nconst performance = window.performance;\r\nconst setTimeout = window.setTimeout;\r\n\r\nlet startTime;\r\nlet lastMeasure;\r\n\r\nconst startMeasure = (name) => {\r\n    startTime = performance.now();\r\n    lastMeasure = name;\r\n};\r\n\r\nconst stopMeasure = () => {\r\n    const last = lastMeasure;\r\n\r\n    if (lastMeasure) {\r\n        setTimeout(() => {\r\n            lastMeasure = null;\r\n            const stop = performance.now();\r\n            console.log(last + ' took ' + (stop - startTime));\r\n        }, 0);\r\n    }\r\n};\r\n\r\nexport class App {\r\n    store: Store;\r\n    tableEl: HTMLElement;\r\n    rootViewEl: HTMLElement;\r\n    selectedElement: HTMLElement;\r\n    constructor({ store }) {\r\n        this.store = store;\r\n        this.buildView();\r\n        this.selectedElement = null;\r\n    }\r\n\r\n    buildView () {\r\n        this.rootViewEl = h('div', {class: 'container'}, [\r\n            h('div', {class: 'jumbotron'},\r\n                h('div', {class: 'row'}, [\r\n                    h('div', {class: 'col-md-6'},\r\n                        h('h1', {}, 'SPUI')\r\n                    ),\r\n                    h('div', {class: 'col-md-6'},\r\n                        h('div', {class: 'row'}, [\r\n                            h('div', {class: 'col-sm-6 smallpad'},\r\n                                h('button', { id: 'run', class: 'btn btn-primary btn-block', type: 'button', onclick: e => this.run()},\r\n                                    'Create 1,000 rows'\r\n                                )\r\n                            ),\r\n                            h('div', {class: 'col-sm-6 smallpad'},\r\n                                h('button', {id: 'runlots', class: 'btn btn-primary btn-block', type: 'button', onclick: e => this.runLots() },\r\n                                    'Create 10,000 rows'\r\n                                )\r\n                            ),\r\n                            h('div', { class: 'col-sm-6 smallpad' },\r\n                                h('button', { id: 'add', class: 'btn btn-primary btn-block', type: 'button', onclick: e => this.add() },\r\n                                    'Append 1,000 rows'\r\n                                )\r\n                            ),\r\n                            h('div', { class: 'col-sm-6 smallpad' },\r\n                                h('button', { id: 'update', class: 'btn btn-primary btn-block', type: 'button', onclick: e => this.update() },\r\n                                    'Update every 10th row'\r\n                                )\r\n                            ),\r\n                            h('div', { class: 'col-sm-6 smallpad' },\r\n                                h('button', { id: 'clear', class: 'btn btn-primary btn-block', type: 'button', onclick: e => this.clear() },\r\n                                    'Clear'\r\n                                )\r\n                            ),\r\n                            h('div', { class: 'col-sm-6 smallpad' },\r\n                                h('button', { id: 'swaprows', class: 'btn btn-primary btn-block', type: 'button', onclick: e => this.swapRows() },\r\n                                    'Swap'\r\n                                )\r\n                            )\r\n                        ])\r\n                    )\r\n                ])\r\n            ),\r\n\r\n            h('table', {class: 'table table-hover table-striped test-data'},\r\n                this.tableEl = elementList('tbody', {}, this.store.data, (tableElement, data) => {\r\n                    return h('tr', {}, [\r\n                        h('td', {class: 'col-md-1'}, data.id),\r\n                        h('td', {class: 'col-md-4'},\r\n                            h('a', { onclick: e => this.select(data.id) }, () => data.label())\r\n                        ),\r\n                        h('td', {class: 'col-md-1'},\r\n                            h('a', { onclick: e => this.remove(data.id) },\r\n                                h('span', {class: 'glyphicon glyphicon-remove', 'aria-hidden': true })\r\n                            )\r\n                        ),\r\n                        h('td', {class: 'col-md-6'})\r\n                    ]);\r\n                })\r\n            ),\r\n            h('span', {class: 'preloadicon glyphicon glyphicon-remove', 'aria-hidden': true })\r\n        ]);\r\n\r\n        s.map(this.store.selected, selectedId => {\r\n            if (this.selectedElement) {\r\n                this.selectedElement.className = '';\r\n            }\r\n\r\n            if (selectedId !== undefined) {\r\n                const nodeList = getElementList(this.tableEl);\r\n                const selectedModel = this.store.data.array.find(model => model.id === selectedId);\r\n                this.selectedElement = nodeList.modelToElement.get(selectedModel);\r\n                this.selectedElement.className = 'danger';\r\n            }\r\n        });\r\n    }\r\n\r\n    add() {\r\n        startMeasure('add');\r\n        this.store.add();\r\n        stopMeasure();\r\n    }\r\n\r\n    remove(id) {\r\n        startMeasure('remove');\r\n        this.store.delete(id);\r\n        stopMeasure();\r\n    }\r\n    select(id) {\r\n        startMeasure('select');\r\n        this.store.select(id);\r\n        stopMeasure();\r\n    }\r\n    run() {\r\n        startMeasure('run');\r\n        this.store.run();\r\n        stopMeasure();\r\n    }\r\n    update() {\r\n        startMeasure('update');\r\n        this.store.update();\r\n        stopMeasure();\r\n    }\r\n    runLots() {\r\n        startMeasure('runLots');\r\n        this.store.runLots();\r\n        stopMeasure();\r\n    }\r\n    clear() {\r\n        startMeasure('clear');\r\n        this.store.clear();\r\n        stopMeasure();\r\n    }\r\n    swapRows() {\r\n        startMeasure('swapRows');\r\n        this.store.swapRows();\r\n        stopMeasure();\r\n    }\r\n}\r\n","import {remove} from './utils';\r\nexport type Changes = Array<Array<any>>;\r\nexport type ArrayListener = (op: string, args: any[], opReturnValue: any) => void;\r\n\r\nexport class ObservableArray<T> {\r\n    array: T[];\r\n    listeners: ArrayListener[];\r\n    changes: Changes;\r\n    constructor(array?: T[]) {\r\n        this.array = array || [];\r\n        this.listeners = [];\r\n        this.changes = null;\r\n    }\r\n\r\n    get length () {\r\n        return this.array.length;\r\n    }\r\n\r\n    push(...args) {\r\n        const retValue = this.array.push.apply(this.array, args);\r\n        this.logChange('push', retValue, args);\r\n        return retValue;\r\n    }\r\n\r\n    pop(...args) {\r\n        const retValue = this.array.pop.apply(this.array, args);\r\n        this.logChange('pop', retValue, args);\r\n        return retValue;\r\n    }\r\n\r\n    reverse(...args) {\r\n        const retValue = this.array.reverse.apply(this.array, args);\r\n        this.logChange('reverse', retValue, args);\r\n        return retValue;\r\n    }\r\n\r\n    shift(...args) {\r\n        const retValue = this.array.shift.apply(this.array, args);\r\n        this.logChange('shift', retValue, args);\r\n        return retValue;\r\n    }\r\n\r\n    splice(...args) {\r\n        const retValue = this.array.splice.apply(this.array, args);\r\n        this.logChange('splice', retValue, args);\r\n        return retValue;\r\n    }\r\n\r\n    sort(...args) {\r\n        const retValue = this.array.sort.apply(this.array, args);\r\n        this.logChange('sort', retValue, args);\r\n        return retValue;\r\n    }\r\n\r\n    unshift(...args) {\r\n        const retValue = this.array.unshift.apply(this.array, args);\r\n        this.logChange('unshift', retValue, args);\r\n        return retValue;\r\n    }\r\n\r\n    remove(value: T) {\r\n        const index = this.array.indexOf(value);\r\n        this.splice(index, 1);\r\n    }\r\n\r\n    applyChanges(changeFunctor: () => any) {\r\n        this.changes = [];\r\n        let result;\r\n        try {\r\n            result = changeFunctor();\r\n        } catch (e) {\r\n            this.changes = null;\r\n            throw e;\r\n        }\r\n        if (this.changes) {\r\n            this.emit('changes', this.changes);\r\n        }\r\n        this.changes = null;\r\n        return result;\r\n    }\r\n\r\n    addListener(callback: ArrayListener) {\r\n        this.listeners.push(callback);\r\n        return () => this.removeListener(callback);\r\n    }\r\n\r\n    removeListener(callback: ArrayListener) {\r\n        return remove(this.listeners, callback);\r\n    }\r\n\r\n    logChange(method, returnValue, args) {\r\n        if (this.changes === null) {\r\n            this.emit(method, args, returnValue);\r\n        } else {\r\n            this.changes.push([method, args, returnValue]);\r\n        }\r\n    }\r\n\r\n    emit(op: string, args: any[], opReturnValue?: any) {\r\n        for (let i = 0; i < this.listeners.length; ++i) {\r\n            this.listeners[i](op, args, opReturnValue);\r\n        }\r\n    }\r\n}\r\n\r\nexport type FilterPredicate<T> = (value: T) => any;\r\nexport class Filter<T> {\r\n    src: ObservableArray<T>;\r\n    filtered: ObservableArray<T>;\r\n    predicate: FilterPredicate<T>;\r\n    constructor(src: ObservableArray<T>, predicate: FilterPredicate<T>) {\r\n        this.src = src;\r\n        this.filtered = new ObservableArray();\r\n        this.predicate = predicate;\r\n\r\n        const srcFiltered = this.src.array.filter(this.predicate);\r\n        this.filtered.push(...srcFiltered);\r\n\r\n        this.src.addListener(this.srcChanged.bind(this));\r\n    }\r\n\r\n    applyFilter(predicate: FilterPredicate<T> = null, reset: boolean = false): Changes {\r\n        if (predicate) {\r\n            this.predicate = predicate;\r\n        }\r\n        const changes = this.filtered.applyChanges(() => {\r\n            if (reset) {\r\n                // Reset filter completely:\r\n                this.filtered.splice(0);\r\n                const filteredValues = this.src.array.filter(this.predicate);\r\n                if (filteredValues.length) {\r\n                    this.filtered.push(...filteredValues);\r\n                }\r\n                return this.filtered.changes;\r\n            } \r\n\r\n            // Apply only differences between 2 filter run:\r\n            let filterIndex = 0;\r\n            for (let srcIndex = 0; srcIndex < this.src.length; ++srcIndex) {\r\n                const srcValue = this.src.array[srcIndex];\r\n                if (this.predicate(srcValue)) {\r\n                    if (filterIndex < this.filtered.length) {\r\n                        if (this.filtered.array[filterIndex] !== srcValue) {\r\n                            this.filtered.splice(filterIndex, 0, srcValue);\r\n                        }\r\n                    } else {\r\n                        this.filtered.splice(filterIndex, 0, srcValue);\r\n                    }\r\n                    ++filterIndex;\r\n                } else {\r\n                    if (filterIndex < this.filtered.length) {\r\n                        if (this.filtered.array[filterIndex] === srcValue) {\r\n                            this.filtered.splice(filterIndex, 1);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // All the others elements are not needed anymore.\r\n            if (filterIndex < this.filtered.length) {\r\n                this.filtered.splice(filterIndex);\r\n            }\r\n            return this.filtered.changes;\r\n        });\r\n        return changes;\r\n    }\r\n\r\n\r\n    private srcChanged(op: string, args: any[], opReturnValue?: any) {\r\n        switch (op) {\r\n            case 'pop':\r\n                if (this.filtered.length && this.filtered.array[this.filtered.length - 1] === opReturnValue) {\r\n                    this.filtered.pop();\r\n                }\r\n                break;\r\n            case 'push': {\r\n                const filterPushedData = args.filter(this.predicate);\r\n                if (filterPushedData.length) {\r\n                    this.filtered.push(...filterPushedData);\r\n                }\r\n                break;\r\n            }\r\n            case 'reverse': {\r\n                if (this.filtered.length) {\r\n                    this.filtered.reverse();\r\n                }\r\n                break;\r\n            };\r\n            case 'splice':\r\n                const elementsToRemove = opReturnValue;\r\n\r\n                const filteredElementsToRemove = elementsToRemove.filter(this.predicate);\r\n                let filteredElementsAdded;\r\n                if (args.length > 2) {\r\n                    const elementsAdded = args.slice(2);\r\n                    filteredElementsAdded = elementsAdded.filter(this.predicate);\r\n                }\r\n\r\n                const srcSpliceStart = args[0] < 0 ? \r\n                    args[0] + this.src.length + elementsToRemove.length - (args.length > 2 ? args.length - 2 : 0) : \r\n                    args[0];\r\n                // Find the insertion point from the start in case not all elements are unique.\r\n                let filteredSpliceStart = 0;\r\n                for (let i = 0; i < srcSpliceStart; ++i) {\r\n                    if (this.predicate(this.src.array[i])) {\r\n                        ++filteredSpliceStart;\r\n                    }\r\n                }\r\n\r\n                if (filteredElementsToRemove && filteredElementsToRemove.length) {\r\n                    if (filteredElementsAdded && filteredElementsAdded.length) {\r\n                        this.filtered.splice(filteredSpliceStart, filteredElementsToRemove.length, ...filteredElementsAdded);\r\n                    } else {\r\n                        this.filtered.splice(filteredSpliceStart, filteredElementsToRemove.length);\r\n                    }\r\n                } else if (filteredElementsAdded && filteredElementsAdded.length) {\r\n                    this.filtered.splice(filteredSpliceStart, 0, ...filteredElementsAdded);\r\n                }\r\n                break;\r\n            case 'shift':\r\n                if (this.filtered.length && this.filtered.array[0] === opReturnValue) {\r\n                    this.filtered.shift();\r\n                }\r\n                break;\r\n            case 'sort': {\r\n                if (this.filtered.length) {\r\n                    this.filtered.sort();\r\n                }\r\n                break;\r\n            }\r\n            case 'unshift': {\r\n                const filterUnshiftedData = args.filter(this.predicate);\r\n                if (filterUnshiftedData.length) {\r\n                    this.filtered.unshift(...filterUnshiftedData);\r\n                }\r\n                break;\r\n            }\r\n            case 'changes': {\r\n                const changes = args;\r\n                for (let i = 0; i < changes.length; ++i) {\r\n                    this.srcChanged.apply(this, changes[i]);\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n}","import * as sp from '../../spui/index';\r\n\r\nfunction random(max) {\r\n    return Math.round(Math.random() * 1000) % max;\r\n}\r\n\r\nconst adjectives = ['pretty', 'large', 'big', 'small', 'tall', 'short', 'long', 'handsome', 'plain', 'quaint', 'clean', 'elegant', 'easy', 'angry', 'crazy', 'helpful', 'mushy', 'odd', 'unsightly', 'adorable', 'important', 'inexpensive', 'cheap', 'expensive', 'fancy'];\r\nconst colours = ['red', 'yellow', 'blue', 'green', 'pink', 'brown', 'purple', 'brown', 'white', 'black', 'orange'];\r\nconst nouns = ['table', 'chair', 'house', 'bbq', 'desk', 'car', 'pony', 'cookie', 'sandwich', 'burger', 'pizza', 'mouse', 'keyboard'];\r\nexport class Store {\r\n    backup: any[];\r\n    data: sp.ObservableArray<any>;\r\n    selected: sp.Stream;\r\n    id: number;\r\n    constructor() {\r\n        this.data = new sp.ObservableArray<any>();\r\n        this.selected = sp.valueStream();\r\n        this.id = 1;\r\n    }\r\n    buildData(count = 1000) {\r\n        const data = [];\r\n        for (let i = 0; i < count; i++) { \r\n            const label = adjectives[random(adjectives.length)] + ' ' + colours[random(colours.length)] + ' ' + nouns[random(nouns.length)];\r\n            data.push({ \r\n                id: this.id++,\r\n                label: sp.valueStream(label)\r\n            }); \r\n        }\r\n        return data;\r\n    }\r\n    updateData(mod = 10) {\r\n        this.data.applyChanges(() => {\r\n            for (let i = 0; i < this.data.length; i += 10) {\r\n                // this.data[i] = Object.assign({}, this.data[i], { label: this.data[i].label + ' !!!' });\r\n                this.data.array[i].label(this.data.array[i].label() + ' !!!');\r\n            }\r\n        });\r\n    }\r\n    delete(id) {\r\n        const idx = this.data.array.findIndex(d => d.id == id);\r\n        this.data.splice(idx, 1);\r\n        return this;\r\n    }\r\n    run() {\r\n        this.data.push.apply(this.data, this.buildData());\r\n        this.selected(undefined);\r\n    }\r\n    add() {\r\n        this.data.push.apply(this.data, this.buildData(1000));\r\n    }\r\n    update() {\r\n        this.updateData();\r\n    }\r\n    select(id) {\r\n        this.selected(id);\r\n    }\r\n    runLots() {\r\n        this.data.push.apply(this.data, this.buildData(10000));\r\n        this.selected(undefined);\r\n    }\r\n    clear() {\r\n        this.data.splice(0);\r\n        this.selected(undefined);\r\n    }\r\n    swapRows() {\r\n        if (this.data.length > 10) {\r\n            this.data.applyChanges(() => {\r\n                const a = this.data[4];\r\n                const b = this.data[9];\r\n                this.data.splice(4, 1, b);\r\n                this.data.splice(9, 1, a);\r\n            });\r\n        }\r\n    }\r\n}\r\n","'use strict';\r\n\r\nimport { App } from './app';\r\nimport { Store } from './store';\r\n\r\nconst store = new Store();\r\nconst app = new App({ store });\r\n\r\ndocument.body.appendChild(app.rootViewEl);"],"names":["s.compute","s.addTransform","s.map","sp.ObservableArray","sp.valueStream"],"mappings":"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"}